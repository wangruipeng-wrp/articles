---
title: JavaScript：垃圾回收机制
abbrlink: 31440
date: 2020-06-07 21:30:45
categories:
 - JavaScript
---
JavaScript有自动收集内存中已经废弃的变量的功能，称为**垃圾回收机制**
<!-- more -->

js中的局部变量仅在函数的执行过程中存在，一旦函数执行完毕之后局部变量则失去了意义，这个时候就需要去释放掉这个变量，回收内存。

上述的这个动作由js的垃圾收集器来完成。

垃圾收集器原理：找出没用的数据、**打上标记**、**释放内存**、**周期性执行**。

## 标识无用变量的策略

#### 标记清除
当变量进入或者是离开执行环境时，会给变量做上一个标记，周期性的将离开执行环境的变量清除。

#### 引用计数（不常用）
当一个**堆内存中的对象**被赋值给一个**栈内存中的引用**时，这个对象的计数 +1。
如果这个**堆内存中的对象**再次被赋值给一个**栈内存中的引用**时，这个对象的计数再 +1。
也就是现在这个对象的计数时2，即两个**栈内存的应用**指向同一个**堆内存的对象**。
如果两个**栈内存中的引**用其中一个发生了改变，也就是不再指向这个**堆内存中的对象**了，那么这个**堆内存中的对象**的计数 -1。
当这个**堆内存中的对象**的计数 =0 的时候，垃圾收集器将释放该对象所占用的内存。

**循环引用的问题**
循环引用就是对象A中包含了一个指向对象B的指针，对象B中包含了一个指向对象A的指针。这样一来两个**堆内存中的对象**的计数都是2，当我们使用完这两个对象之后，垃圾收集器将无法回收这两个变量。需要我们手动的去将这两个对象置为 `null` 来释放内存。例如：
```js
var ObjA = {};  // ObjA计数1
var ObjB = {};  // ObjB计数1

ObjA.obj = ObjB; // ObjB计数2
ObjB.obj = ObjA; // ObjA计数2

// 手动释放内存
ObjA = null;
ObjB = null;
```